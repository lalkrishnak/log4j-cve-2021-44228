---
- name: Test connection
  hosts: all
  gather_facts: true
  become: true

  tasks:
    - name: Test connection
      ping:

    - name: Create the user devops as a member of the group wheel
      user:
        group: wheel
        name: devops

    - name: Install the sudo configuration which allows passwordless execution of command as root
      copy:
        src: devops.sudo
        dest: /etc/sudoers.d/devops

    - name: Authorize the ssh key devops
      authorized_key:
        manage_dir: yes
        user: devops
        key: "{{ lookup('file', '~/.ssh/id_rsa.pub') }}"
